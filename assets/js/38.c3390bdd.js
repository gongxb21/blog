(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{195:function(t,_,v){"use strict";v.r(_);var e={props:["slot-key"],mounted:function(){this.$nextTick(function(){this.$vuepress.$emit("AsyncMarkdownContentMounted",this.slotKey)})}},l=v(5),a=Object(l.a)(e,function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.slotKey}},[v("h1",{attrs:{id:"fileupload"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#fileupload","aria-hidden":"true"}},[t._v("#")]),t._v(" FileUpload")]),t._v(" "),v("hr"),t._v(" "),v("h2",{attrs:{id:"uploadservice"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#uploadservice","aria-hidden":"true"}},[t._v("#")]),t._v(" UploadService")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("概念")]),t._v(" "),v("ul",[v("li",[t._v("ExcelType 对应不同类型的文件，枚举类型")]),t._v(" "),v("li",[t._v("Cloumn excel中不同的列，枚举类型")]),t._v(" "),v("li",[t._v("ExcelColumnMapping 表单和列的对应关系")])])]),t._v(" "),v("li",[v("p",[t._v("表结构设计")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("import_excel_field_mapping")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("字段名")]),t._v(" "),v("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),v("th",[t._v("备注")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("mapping_code")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("主键")])]),t._v(" "),v("tr",[v("td",[t._v("ent_code")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("企业code")])]),t._v(" "),v("tr",[v("td",[t._v("excel_type")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("excel类型")])]),t._v(" "),v("tr",[v("td",[t._v("mapping_data")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("json")]),t._v(" "),v("td",[t._v("映射关系")])]),t._v(" "),v("tr",[v("td",[t._v("mapping_name")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("映射规则名称")])])])])])])]),t._v(" "),v("li",[v("p",[t._v("对外提供一些基础的查询接口")])])]),t._v(" "),v("hr"),t._v(" "),v("p",[t._v("文档上传")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("固定的表单：（往来单位及账户、选项组）\n可以使用主板封装的注解实现，但是暂时还没有关注他有哪些列，待验证")])]),t._v(" "),v("li",[v("p",[t._v("自定义的表单（企业支付订单导入）\n用poi 工具去生成，校验，生成费用")]),t._v(" "),v("ol",[v("li",[t._v("基础校验")]),t._v(" "),v("li",[t._v("把excel 转成list，校验必填项，封装到errMsg 中")]),t._v(" "),v("li",[t._v("业务校验（唯一性，有效性），封装到errMsg中")])]),t._v(" "),v("ul",[v("li",[t._v("如果有错误，生成新的excel，上传到oss, 修改任务记录。")])]),t._v(" "),v("ol",{attrs:{start:"4"}},[v("li",[t._v("生成订单记录表（import_tmc_order）")]),t._v(" "),v("li",[t._v("调用接口写费用表和第三方费用表")])])]),t._v(" "),v("li",[v("p",[t._v("数据库表设计\n上传的任务记录表")]),t._v(" "),v("ul",[v("li",[v("p",[t._v("import_excel_task")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("字段名")]),t._v(" "),v("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),v("th",[t._v("备注")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("code")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("主键")])]),t._v(" "),v("tr",[v("td",[t._v("ent_code")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("企业code")])]),t._v(" "),v("tr",[v("td",[t._v("excel_type")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("excel类型")])]),t._v(" "),v("tr",[v("td",[t._v("user_code")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("用户code")])]),t._v(" "),v("tr",[v("td",[t._v("import_at")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("timestamp")]),t._v(" "),v("td",[t._v("上传时间")])]),t._v(" "),v("tr",[v("td",[t._v("import_params")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("json")]),t._v(" "),v("td",[t._v("上传时候的参数")])]),t._v(" "),v("tr",[v("td",[t._v("import_status")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("状态")])]),t._v(" "),v("tr",[v("td",[t._v("import_error")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("错误")])]),t._v(" "),v("tr",[v("td",[t._v("import_result")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("上传的结果")]),t._v(" "),v("td",[t._v("用来存放错误url的列")])]),t._v(" "),v("tr",[v("td",[t._v("completed_time")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("timestamp")]),t._v(" "),v("td",[t._v("完成时间")])])])])]),t._v(" "),v("li",[v("p",[t._v("导入订单记录表（import_tmc_order）")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("字段名")]),t._v(" "),v("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),v("th",[t._v("备注")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("code")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("主键")])]),t._v(" "),v("tr",[v("td",[t._v("ent_code")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("企业code")])]),t._v(" "),v("tr",[v("td",[t._v("excel_type")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("excel类型")])]),t._v(" "),v("tr",[v("td",[t._v("mapping_code")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("varchar")]),t._v(" "),v("td",[t._v("用户code")])]),t._v(" "),v("tr",[v("td",[t._v("order_data")]),t._v(" "),v("td",{staticStyle:{"text-align":"left"}},[t._v("json")]),t._v(" "),v("td",[t._v("上传时候的参数")])])])])])])]),t._v(" "),v("li",[v("p",[t._v("其他问题")]),t._v(" "),v("ol",[v("li",[t._v("导入订单记录表\n列不固定，所以一行数据封装成json 保存。另外 excel 中订单详情是k-v结构的数据，可能需要转化成json。")]),t._v(" "),v("li",[t._v("带数据报表的模板下载\n暂时可以先不做")])])])])])},[],!1,null,null,null);a.options.__file="file_upload.md";_.default=a.exports}}]);