# 数据库索引

索引在日常的查询中用的很多，在面试的时间也经常被问题，用一点时间统一整理下。

## 什么是索引？
索引就像之前用的字典的拼音，用于快速查找表中的某一条数据或某一些数据。如果没有索引，那么数据库引擎只能全表扫描，表越大，扫描的时间越长，查询的速度越慢。如果表中查询的列有一个索引，MySQL没有必要检索全表，可以直接找到某些数据。就好像我们可以根据拼音快速找到某个字在字典中的位置。

## MySQL中索引的优点和缺点和使用原则
### 优点：
- 通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性。 
- 可以大大加快 数据的检索速度，这也是创建索引的最主要的原因。  
- 可以加速表和表之间的连接，特别是在实现数据的参考完整性方面特别有意义。 
- 在使用分组和排序 子句进行数据检索时，同样可以显著减少查询中分组和排序的时间。 
- 通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能。
### 缺点：
- 创建索引和维护索引要耗费时间，并且随着数据量的增加所耗费的时间也会增加
- 索引也需要占空间，我们知道数据表中的数据也会有最大上线设置的，如果我们有大量的索引，索引文件可能会比数据文件更快达到上线值
- 当对表中的数据进行增加、删除、修改时，索引也需要动态的维护，降低了数据的维护速度。

### 使用原则：
- 对经常更新的表就避免对其进行过多的索引，对经常用于查询的字段应该创建索引，
- 数据量小的表最好不要使用索引，因为由于数据较少，可能查询全部数据花费的时间比遍历索引的时间还要短，索引就可能不会产生优化效果。
- 在一同值少的列上(字段上)不要建立索引，比如在学生表的"性别"字段上只有男，女两个不同值。相反的，在一个字段上不同值较多可是建立索引。
- 尽量避免Null，null会让索引，索引统计和值比较都变得更加复杂，尽量不要在null列建索引。
先基本上理解索引，然后等以后真正用到了，就会慢慢知道别的作用。注意，学习这张，很重要的一点就是必须先得知道索引是什么，索引是干嘛的，有什么作用，为什么要索引等等，如果不知道，就重复往上面看看写的文字，好好理解一下。一个表中很够创建多个索引，这些索引度会被存放到一个索引文件中(专门存放索引的地方)。

### 索引的分类　　
注意：索引是在存储引擎中实现的，也就是说不同的存储引擎，会使用不同的索引
MyISAM和InnoDB存储引擎：只支持BTREE索引， 也就是说默认使用BTREE，不能够更换
MEMORY/HEAP存储引擎：支持HASH和BTREE索引

 索引我们分为四类来讲 单列索引(普通索引，唯一索引，主键索引)、组合索引、全文索引、空间索引、

1. 单列索引：一个索引只包含单个列，但一个表中可以有多个单列索引。 这里不要搞混淆了。
     - 普通索引：MySQL中基本索引类型，没有什么限制，允许在定义索引的列中插入重复值和空值，纯粹为了查询数据更快一点。
   - 唯一索引：索引列中的值必须是唯一的，但是允许为空值，
   - 主键索引：是一种特殊的唯一索引，不允许有空值。
2. 组合索引
 在表中的多个字段组合上创建的索引，只有在查询条件中使用了这些字段的左边字段时，索引才会被使用，使用组合索引时遵循最左前缀集合。这个如果还不明白，等后面举例讲解时在细说　
3. 全文索引
全文索引，只有在MyISAM引擎上才能使用，只能在CHAR,VARCHAR,TEXT类型字段上使用全文索引，在实际工作中并没有使用过，因为InnoDB 是用的更普遍的数据库引擎。

4. 空间索引 
   空间索引是对空间数据类型的字段建立的索引，MySQL中的空间数据类型有四种，GEOMETRY、POINT、LINESTRING、POLYGON。在创建空间索引时，使用SPATIAL关键字。要求，引擎为MyISAM，创建空间索引的列，必须将其声明为NOT NULL。　　

 ## 索引操作(创建和删除)
1. 创建索引
    1. 创建表的时候创建索引
    ```sql
    CREATE TABLE  表名( 属性名 数据类型[完整性约束条件], 
        属性名 数据类型[完整性约束条件], 
        ...... 
        属性名 数据类型  
        [ UNIQUE | FULLTEXT | SPATIAL ]  INDEX | KEY 
        [ 别名]  ( 属性名1  [(长度)]  [ ASC | DESC] ) 
    );
    ```
    2. 在创建表之后通过alter table命令修改：
      - 添加普通索引： ALTER TABLE t_user ADD INDEX IDX_USER__USER_ID(user_id);  
      - 添加唯一索引： ALTER TABLE t_user ADD UNIQUE INDEX IDX_USER__UNQ_USER_ID(user_id); 
      - 添加复合索引： ALTER TABLE t_user ADD UNIQUE INDEX IDX_USER__COMP_USER_ID(user_id,user_name);  

## 参考
- [参考1]：高可用MYSQL