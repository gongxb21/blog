<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mysql 查询过程 | GXB</title>
    <meta name="description" content="读书笔记、踩坑记录、知识梳理">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.96e0297f.css" as="style"><link rel="preload" href="/blog/assets/js/app.5e9a26d2.js" as="script"><link rel="preload" href="/blog/assets/js/2.c18dedb2.js" as="script"><link rel="preload" href="/blog/assets/js/8.3eb52f53.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.010da03c.js"><link rel="prefetch" href="/blog/assets/js/11.829a28ae.js"><link rel="prefetch" href="/blog/assets/js/12.2581aed9.js"><link rel="prefetch" href="/blog/assets/js/13.10b19774.js"><link rel="prefetch" href="/blog/assets/js/14.cc88eca3.js"><link rel="prefetch" href="/blog/assets/js/15.0ab8915e.js"><link rel="prefetch" href="/blog/assets/js/16.9b627884.js"><link rel="prefetch" href="/blog/assets/js/17.e8d528d4.js"><link rel="prefetch" href="/blog/assets/js/18.c676807d.js"><link rel="prefetch" href="/blog/assets/js/19.b903398f.js"><link rel="prefetch" href="/blog/assets/js/20.23554b7b.js"><link rel="prefetch" href="/blog/assets/js/21.b0cecbcf.js"><link rel="prefetch" href="/blog/assets/js/22.9f1f1bf0.js"><link rel="prefetch" href="/blog/assets/js/23.45682cd0.js"><link rel="prefetch" href="/blog/assets/js/24.27acf613.js"><link rel="prefetch" href="/blog/assets/js/25.2c2e46fa.js"><link rel="prefetch" href="/blog/assets/js/26.eb221cc8.js"><link rel="prefetch" href="/blog/assets/js/27.ce936faf.js"><link rel="prefetch" href="/blog/assets/js/28.8aa413ad.js"><link rel="prefetch" href="/blog/assets/js/29.73086d0a.js"><link rel="prefetch" href="/blog/assets/js/3.c3098d31.js"><link rel="prefetch" href="/blog/assets/js/30.c09458df.js"><link rel="prefetch" href="/blog/assets/js/31.f4b835c1.js"><link rel="prefetch" href="/blog/assets/js/32.8aa13c5b.js"><link rel="prefetch" href="/blog/assets/js/33.42dad9ab.js"><link rel="prefetch" href="/blog/assets/js/34.670b19c9.js"><link rel="prefetch" href="/blog/assets/js/35.65b564a1.js"><link rel="prefetch" href="/blog/assets/js/36.4bbe68b5.js"><link rel="prefetch" href="/blog/assets/js/37.c5e6dc9b.js"><link rel="prefetch" href="/blog/assets/js/38.8f88fd1a.js"><link rel="prefetch" href="/blog/assets/js/39.948afeab.js"><link rel="prefetch" href="/blog/assets/js/4.07463fb4.js"><link rel="prefetch" href="/blog/assets/js/40.9e1dadb8.js"><link rel="prefetch" href="/blog/assets/js/41.a60d3e35.js"><link rel="prefetch" href="/blog/assets/js/42.e8578c20.js"><link rel="prefetch" href="/blog/assets/js/43.11be97b1.js"><link rel="prefetch" href="/blog/assets/js/44.43613711.js"><link rel="prefetch" href="/blog/assets/js/45.06bb4330.js"><link rel="prefetch" href="/blog/assets/js/46.222a6b90.js"><link rel="prefetch" href="/blog/assets/js/47.bedae49d.js"><link rel="prefetch" href="/blog/assets/js/48.8dfc27aa.js"><link rel="prefetch" href="/blog/assets/js/49.0b90a2f0.js"><link rel="prefetch" href="/blog/assets/js/5.b3ed564e.js"><link rel="prefetch" href="/blog/assets/js/50.09c1cfd9.js"><link rel="prefetch" href="/blog/assets/js/51.b2639775.js"><link rel="prefetch" href="/blog/assets/js/52.23beb4e3.js"><link rel="prefetch" href="/blog/assets/js/53.ceabf5a1.js"><link rel="prefetch" href="/blog/assets/js/54.6f93e9ab.js"><link rel="prefetch" href="/blog/assets/js/55.1621d9a1.js"><link rel="prefetch" href="/blog/assets/js/56.e696f5e4.js"><link rel="prefetch" href="/blog/assets/js/57.6479a358.js"><link rel="prefetch" href="/blog/assets/js/58.cb1f842a.js"><link rel="prefetch" href="/blog/assets/js/59.f188cae4.js"><link rel="prefetch" href="/blog/assets/js/6.dd4310bf.js"><link rel="prefetch" href="/blog/assets/js/60.66fd50ea.js"><link rel="prefetch" href="/blog/assets/js/61.978bad1e.js"><link rel="prefetch" href="/blog/assets/js/62.28bdffd4.js"><link rel="prefetch" href="/blog/assets/js/63.88184b82.js"><link rel="prefetch" href="/blog/assets/js/64.94a70348.js"><link rel="prefetch" href="/blog/assets/js/65.b0cb66f9.js"><link rel="prefetch" href="/blog/assets/js/66.3010eea5.js"><link rel="prefetch" href="/blog/assets/js/67.2c86e47e.js"><link rel="prefetch" href="/blog/assets/js/68.d6cf0267.js"><link rel="prefetch" href="/blog/assets/js/69.72314006.js"><link rel="prefetch" href="/blog/assets/js/7.659e2330.js"><link rel="prefetch" href="/blog/assets/js/9.df894e16.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.96e0297f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">GXB</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的博客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/index.html" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/blog/database/index.html" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/blog/docker/index.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/blog/other/index.html" class="nav-link">其他</a></li></ul></div></div> <a href="https://github.com/gongxb21/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的博客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/index.html" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/blog/database/index.html" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/blog/docker/index.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/blog/other/index.html" class="nav-link">其他</a></li></ul></div></div> <a href="https://github.com/gongxb21/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Mysql 查询过程</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/database/query.html#连接" class="sidebar-link">连接</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/database/query.html#处理" class="sidebar-link">处理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/database/query.html#获取结果" class="sidebar-link">获取结果</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content default"><h1 id="mysql-查询过程"><a href="#mysql-查询过程" aria-hidden="true" class="header-anchor">#</a> Mysql 查询过程</h1> <p><img src="/blog/assets/img/mysql_query.341e3c17.jpeg" alt="mysql 查询过程"></p> <h2 id="连接"><a href="#连接" aria-hidden="true" class="header-anchor">#</a> 连接</h2> <ol><li>客户端把语句发送给服务器端执行
<ol><li>在客户端发起一条语句查询，监听客户端的'连接管理磨块'接受请求</li> <li>将请求转发到'连接进/线程模块'</li> <li> 调用‘用户  模块 ’进行授权检查</li> <li> 通过检查后，‘连接进/线程模块’从‘线程连接池’中取出空闲的被缓存的连接线程和客户端请求对接，如果失败则创建一个新的连接请求</li></ol></li></ol> <h2 id="处理"><a href="#处理" aria-hidden="true" class="header-anchor">#</a> 处理</h2> <ol><li><p>查询高速缓存
服务器会先在数据库的高速缓存中去查找，是否有相同语句的执行计划，如果查找到了，就直接执行这个 sql, 省去后续的工作。所以高速缓存能够提高 sql 的查询效率。一方面从内存中读取数据的效率较高；另一方面是省去了语句解析的原因。</p> <p>不过值得注意的一点是，这里的高速缓存和客户端软件的缓存是两码事，有的客户端为了提高查询效率也会设置缓存。 但是，其他人在服务器上  进行了相关的修改，导致修改的数据不能  及时反映到客户端上。可以看出  这两种缓存不是一码事。</p></li> <li><p>语句合法性检查
服务器进程就会开始检查这条语句的合法性。这里主要是对 SQL 语句的语法进行检查。如果服务器进程认为这条 SQL 语句不符合语法规则的时候,就会把这个错误信息,反馈给客户端。在这个语法检查的过程中,不会对 SQL 语句中所包含的表名、列名等等进行 SQL 他只是语法上的检查。</p></li> <li><p>语言含义检查。
若 SQL 语句符合语法上的定义的话,则服务器进程 接下去会对语句中的字段、表等内容进行检查。看看这些字段、表是否在数据库中。如果表名与列名不 准确的话,则数据库会就会反馈错误信息给客户端。</p></li> <li><p>获得对象解析锁
当语法、语义都正确后,系统就会对我们需要查询的对象加锁。这主要是为了保障数据的一致性,防止我们在查询的过程中,其他用户对这个对象的结构发生改变。</p></li> <li><p>数据访问权限的核对
当语法、语义通过检查之后,服务器进程还会检查,你所连接的用户是否有这个数据访问的权限。若你连接上服务器的用户不具有数据访问权限的话,则客户端就不能够取得这些数据。有时候我们查询数据的时候,辛辛苦 苦地把 SQL 语句写好、编译通过,但是,最后系统返回个 “没有权限访问数据”的错误信息,让我们气 半死。这在前端应用软件开发调试的过程中,可能会碰到。所以,要注意这个问题,数据库服务器进程先检查语法与语义,然后才会检查访问权限。</p></li> <li><p>确定最佳执行计划
当语句与语法都没有问题,权限也匹配的话,服务器进程会根据一定的规则,对这条语句进行优化。不过要注意,这个优化是有限的。一般在应用软件开发的过程中,需要对数据库的 sql 语言进行优化,这个优化的作用要大大地大于服务器进程的自我优化。所以,一般在应用软件开发的时候,数据库的优化是少不了的。当服务器进程的优化器确定这条查询语句的最佳执行计划后,就会将这条 SQL 语句与执行计划保存到数据高速缓存。如此的话,等以后还有这个查询时,就会省略以上的语法、语义与权限检查的步骤,而直接执行 SQL 语句,提高 SQL 语句处理效率。</p></li></ol> <h2 id="获取结果"><a href="#获取结果" aria-hidden="true" class="header-anchor">#</a> 获取结果</h2> <ol><li>query 请求完成后，将结果集返回给‘连接进/线程模块’</li> <li>返回的也可以是相应的状态标识，如成功或失败等</li> <li>‘连接进/线程模块’进行后续的清理工作，并继续等待请求或断开与客户端的连接</li></ol></div> <!----> <!----> </div></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.5e9a26d2.js" defer></script><script src="/blog/assets/js/2.c18dedb2.js" defer></script><script src="/blog/assets/js/8.3eb52f53.js" defer></script>
  </body>
</html>
