<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title> 数据库索引 | GXB</title>
    <meta name="description" content="读书笔记、踩坑记录、知识梳理">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.96e0297f.css" as="style"><link rel="preload" href="/blog/assets/js/app.82e01c61.js" as="script"><link rel="preload" href="/blog/assets/js/2.cf64eefe.js" as="script"><link rel="preload" href="/blog/assets/js/22.70640872.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.d5b449d8.js"><link rel="prefetch" href="/blog/assets/js/11.0e2c72e5.js"><link rel="prefetch" href="/blog/assets/js/12.6aeed6ee.js"><link rel="prefetch" href="/blog/assets/js/13.7756da08.js"><link rel="prefetch" href="/blog/assets/js/14.35660256.js"><link rel="prefetch" href="/blog/assets/js/15.824a1134.js"><link rel="prefetch" href="/blog/assets/js/16.dff1f263.js"><link rel="prefetch" href="/blog/assets/js/17.14a9de78.js"><link rel="prefetch" href="/blog/assets/js/18.22320896.js"><link rel="prefetch" href="/blog/assets/js/19.6564bf04.js"><link rel="prefetch" href="/blog/assets/js/20.41b76290.js"><link rel="prefetch" href="/blog/assets/js/21.7cde4f68.js"><link rel="prefetch" href="/blog/assets/js/23.f2a2bbe4.js"><link rel="prefetch" href="/blog/assets/js/24.2b45bb43.js"><link rel="prefetch" href="/blog/assets/js/25.7a888673.js"><link rel="prefetch" href="/blog/assets/js/26.3f3d0cd5.js"><link rel="prefetch" href="/blog/assets/js/27.f94d46ee.js"><link rel="prefetch" href="/blog/assets/js/28.e400cddb.js"><link rel="prefetch" href="/blog/assets/js/29.f7330e45.js"><link rel="prefetch" href="/blog/assets/js/3.6fd3cb61.js"><link rel="prefetch" href="/blog/assets/js/30.800ec521.js"><link rel="prefetch" href="/blog/assets/js/31.b82cc247.js"><link rel="prefetch" href="/blog/assets/js/32.d3a041fe.js"><link rel="prefetch" href="/blog/assets/js/33.b418c4d7.js"><link rel="prefetch" href="/blog/assets/js/34.8518b506.js"><link rel="prefetch" href="/blog/assets/js/35.bd6960dd.js"><link rel="prefetch" href="/blog/assets/js/36.497d5a13.js"><link rel="prefetch" href="/blog/assets/js/37.707f2d1a.js"><link rel="prefetch" href="/blog/assets/js/38.dacf6f7f.js"><link rel="prefetch" href="/blog/assets/js/39.9c074ede.js"><link rel="prefetch" href="/blog/assets/js/4.d45ce864.js"><link rel="prefetch" href="/blog/assets/js/40.8ab37987.js"><link rel="prefetch" href="/blog/assets/js/41.f93e01ba.js"><link rel="prefetch" href="/blog/assets/js/42.3fbb893c.js"><link rel="prefetch" href="/blog/assets/js/43.eb30d965.js"><link rel="prefetch" href="/blog/assets/js/44.9b2671b5.js"><link rel="prefetch" href="/blog/assets/js/45.eb1b684a.js"><link rel="prefetch" href="/blog/assets/js/46.ee2ea42f.js"><link rel="prefetch" href="/blog/assets/js/47.f8f79212.js"><link rel="prefetch" href="/blog/assets/js/48.80686144.js"><link rel="prefetch" href="/blog/assets/js/49.c8cb4e42.js"><link rel="prefetch" href="/blog/assets/js/5.62ff5e2c.js"><link rel="prefetch" href="/blog/assets/js/50.1138c16a.js"><link rel="prefetch" href="/blog/assets/js/51.6484b925.js"><link rel="prefetch" href="/blog/assets/js/52.8c4ef79f.js"><link rel="prefetch" href="/blog/assets/js/53.822b0e61.js"><link rel="prefetch" href="/blog/assets/js/54.84bbeaf4.js"><link rel="prefetch" href="/blog/assets/js/55.7e7692f4.js"><link rel="prefetch" href="/blog/assets/js/56.f7a3d41e.js"><link rel="prefetch" href="/blog/assets/js/57.a4cecea1.js"><link rel="prefetch" href="/blog/assets/js/58.c93ab2d0.js"><link rel="prefetch" href="/blog/assets/js/59.cd61e0a1.js"><link rel="prefetch" href="/blog/assets/js/6.39076755.js"><link rel="prefetch" href="/blog/assets/js/60.274aeb15.js"><link rel="prefetch" href="/blog/assets/js/61.2f3803a7.js"><link rel="prefetch" href="/blog/assets/js/62.a9284191.js"><link rel="prefetch" href="/blog/assets/js/7.ec2bf5b9.js"><link rel="prefetch" href="/blog/assets/js/8.ce36e018.js"><link rel="prefetch" href="/blog/assets/js/9.4d85ca3a.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.96e0297f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">GXB</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的博客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/index.html" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/blog/database/index.html" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/blog/docker/index.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/blog/other/index.html" class="nav-link">其他</a></li></ul></div></div> <a href="https://github.com/gongxb21/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">我的博客</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/index.html" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/blog/database/index.html" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/blog/docker/index.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/blog/other/index.html" class="nav-link">其他</a></li></ul></div></div> <a href="https://github.com/gongxb21/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
      GitHub
      <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span> 数据库索引</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/database/indexes.html#什么是索引？" class="sidebar-link">什么是索引？</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/database/indexes.html#mysql-索引要点" class="sidebar-link">MySQL 索引要点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/database/indexes.html#优点" class="sidebar-link">优点</a></li><li class="sidebar-sub-header"><a href="/blog/database/indexes.html#缺点" class="sidebar-link">缺点</a></li><li class="sidebar-sub-header"><a href="/blog/database/indexes.html#使用原则" class="sidebar-link">使用原则</a></li><li class="sidebar-sub-header"><a href="/blog/database/indexes.html#索引的分类" class="sidebar-link">索引的分类</a></li></ul></li><li><a href="/blog/database/indexes.html#索引创建和删除" class="sidebar-link">索引创建和删除</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/database/indexes.html#索引的使用策略" class="sidebar-link">索引的使用策略</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/database/indexes.html#参考" class="sidebar-link">参考</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content default"><h1 id="数据库索引"><a href="#数据库索引" aria-hidden="true" class="header-anchor">#</a>  数据库索引</h1> <p> 索引在日常的查询中用的很多，在面试的时间也  经常被问题，用一点时间统一整理下。</p> <h2 id="什么是索引？"><a href="#什么是索引？" aria-hidden="true" class="header-anchor">#</a> 什么是索引？</h2> <p>索引就像之前用的字典的拼音，用于快速查找表中的某一条数据或某一些数据。如果没有索引，那么数据库引擎只能全表扫描 ，表越大，扫描的时间  越长，查询的速度越慢。如果表中查询的列有一个索引，MySQL 没有  必要检索全表，可以直接找到某些数据。就好像我们可以根据拼音快速找到某个字在字典中的位置。</p> <h2 id="mysql-索引要点"><a href="#mysql-索引要点" aria-hidden="true" class="header-anchor">#</a> MySQL 索引要点</h2> <h3 id="优点"><a href="#优点" aria-hidden="true" class="header-anchor">#</a> 优点</h3> <ul><li>通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性。</li> <li>可以大大加快 数据的检索速度，这也是创建索引的最主要的原因。</li> <li>可以加速表和表之间的连接，特别是在实现数据的参考完整性方面特别有意义。</li> <li>在使用分组和排序 子句进行数据检索时，同样可以显著减少查询中分组和排序的时间。</li> <li>通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能。</li></ul> <h3 id="缺点"><a href="#缺点" aria-hidden="true" class="header-anchor">#</a> 缺点</h3> <ul><li>创建索引和维护索引要耗费时间，并且随着数据量的增加所耗费的时间也会增加</li> <li>索引也需要占空间，我们知道数据表中的数据也会有最大上限设置的，如果我们有大量的索引，索引文件可能会比数据文件更快达到上限值。一般来说，索引表占用的空间的数据表的 1.5 倍；索引表的维护和创建需要时间成本，这个成本随着数据量增大而增大</li> <li>当对表中的数据进行增加、删除、修改时，索引也需要动态的维护索引表，降低了数据的维护速度。</li></ul> <h3 id="使用原则"><a href="#使用原则" aria-hidden="true" class="header-anchor">#</a> 使用原则</h3> <ul><li>对经常更新的表就避免对其进行过多的索引，对经常用于查询的字段应该创建索引，</li> <li>数据量小的表最好不要使用索引，因为由于数据较少，可能查询全部数据花费的时间比遍历索引的时间还要短，索引就可能不会产生优化效果。</li> <li>在一同值少的列上(字段上)不要建立索引，比如在学生表的&quot;性别&quot;字段上只有男，女两个不同值。相反的，在一个字段上不同值较多可是建立索引。</li> <li>尽量避免 Null，null 会让索引，索引统计和值比较都变得更加复杂，尽量不要在 null 列建索引。</li></ul> <p>先基本上理解索引，然后等以后真正用到了，就会慢慢知道别的作用。注意，学习这张，很重要的一点就是必须先得知道索引是什么，索引是干嘛的，有什么作用，为什么要索引等等，如果不知道，就重复往上面看看写的文字，好好理解一下。一个表中很够创建多个索引，这些索引度会被存放到一个索引文件中(专门存放索引的地方)。</p> <h3 id="索引的分类"><a href="#索引的分类" aria-hidden="true" class="header-anchor">#</a> 索引的分类</h3> <p>注意：索引是在存储引擎中实现的，也就是说不同的存储引擎，会使用不同的索引
MyISAM 和 InnoDB 存储引擎：只支持 BTREE 索引， 也就是说默认使用 BTREE，不能够更换
MEMORY/HEAP 存储引擎：支持 HASH 和 BTREE 索引</p> <p>索引我们分为四类来讲 单列索引(普通索引，唯一索引，主键索引)、组合索引、全文索引、空间索引、</p> <ol><li><p>单列索引：一个索引只包含单个列，但一个表中可以有多个单列索引。 这里不要搞混淆了。</p> <ul><li>普通索引：MySQL 中基本索引类型，没有什么限制，允许在定义索引的列中插入重复值和空值，纯粹为了查询数据更快一点。</li> <li>唯一索引：索引列中的值必须是唯一的，但是允许为空值，</li> <li>主键索引：是一种特殊的唯一索引，不允许有空值。</li></ul></li> <li><p>组合索引
在表中的多个字段组合上创建的索引，只有在查询条件中使用了这些字段的左边字段时，索引才会被使用，使用组合索引时遵循最左前缀集合。
组合索引：用多个列组合构建的索引，这多个列中的值不允许有空值</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token string">'table_name'</span> <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> index_name<span class="token punctuation">(</span><span class="token string">'col1'</span><span class="token punctuation">,</span><span class="token string">'col2'</span><span class="token punctuation">,</span><span class="token string">'col3'</span><span class="token punctuation">)</span>；
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>遵循“<em>最左前缀</em>”原则，把最常用作为检索或排序的列放在最左，依次递减，组合索引相当于建立了 col1,col1col2,col1col2col3 三个索引，而 col2 或者 col3 是不能使用索引的</strong>。
在使用组合索引的时候可能因为列名长度过长而导致索引的 key 太大，导致效率降低，在允许的情况下，可以只取 col1 和 col2 的前几个字符作为索引</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token string">'table_name'</span> <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> index_name<span class="token punctuation">(</span>col1<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>col2（<span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>；
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>表示使用 col1 的前 4 个字符和 col2 的前 3 个字符作为索引</p></li> <li><p>全文索引
全文索引，只有在 MyISAM 引擎上才能使用，只能在 CHAR,VARCHAR,TEXT 类型字段上使用全文索引， 在实际工作中  并  没有使用过，因为 InnoDB 是用的更普遍的数据库引擎。</p></li> <li><p>空间索引
空间索引是对空间数据类型的字段建立的索引，MySQL 中的空间数据类型有四种，GEOMETRY、POINT、LINESTRING、POLYGON。在创建空间索引时，使用 SPATIAL 关键字。要求，引擎为 MyISAM，创建空间索引的列，必须将其声明为 NOT NULL。</p></li></ol> <h2 id="索引创建和删除"><a href="#索引创建和删除" aria-hidden="true" class="header-anchor">#</a> 索引创建和删除</h2> <ol><li><p>创建索引</p> <ol><li>创建表的时候创建索引</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span>  表名<span class="token punctuation">(</span> 属性名 数据类型<span class="token punctuation">[</span>完整性约束条件<span class="token punctuation">]</span><span class="token punctuation">,</span>
    属性名 数据类型<span class="token punctuation">[</span>完整性约束条件<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    属性名 数据类型
    <span class="token punctuation">[</span> <span class="token keyword">UNIQUE</span> <span class="token operator">|</span> FULLTEXT <span class="token operator">|</span> SPATIAL <span class="token punctuation">]</span>  <span class="token keyword">INDEX</span> <span class="token operator">|</span> <span class="token keyword">KEY</span>
    <span class="token punctuation">[</span> 别名<span class="token punctuation">]</span>  <span class="token punctuation">(</span> 属性名<span class="token number">1</span>  <span class="token punctuation">[</span><span class="token punctuation">(</span>长度<span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token punctuation">[</span> <span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="2"><li>在创建表之后通过 alter table 命令修改：</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token operator">-</span> 添加普通索引： <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> t_user <span class="token keyword">ADD</span> <span class="token keyword">INDEX</span> IDX_USER__USER_ID<span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span> 添加唯一索引： <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> t_user <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> IDX_USER__UNQ_USER_ID<span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">-</span> 添加复合索引： <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> t_user <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> IDX_USER__COMP_USER_ID<span class="token punctuation">(</span>user_id<span class="token punctuation">,</span>user_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol> <h2 id="索引的使用策略"><a href="#索引的使用策略" aria-hidden="true" class="header-anchor">#</a> 索引的使用策略</h2> <ol><li>什么时候要使用索引？</li></ol> <ul><li>主键自动建立唯一索引；</li> <li>经常作为查询条件在 WHERE 或者 ORDER BY 语句中出现的列要建立索引；</li> <li>作为排序的列要建立索引；</li> <li>查询中与其他表关联的字段，外键关系建立索引</li> <li>高并发条件下倾向组合索引；</li></ul> <ol start="2"><li>什么时候不要使用索引？</li></ol> <ul><li>经常增删改的列不要建立索引；</li> <li>有大量重复的列不建立索引；</li> <li>表记录太少不要建立索引；</li> <li>在组合索引中不能有列的值为 NULL，如果有，那么这一列对组合索引就是无效的；</li> <li>在一个 SELECT 语句中，索引只能使用一次，如果在 WHERE 中使用了，那么在 ORDER BY 中就不要用了；</li> <li>LIKE 操作中，'%aaa%'不会使用索引，也就是索引会失效，但是‘aaa%’可以使用索引；</li> <li>在索引的列上使用表达式或者函数会使索引失效，例如：select * from users where YEAR(adddate)&lt;2018，将在每个行上进行运算，这将导致索引失效而进行全表扫描，因此我们可以改成：select * from users where adddate&lt;’2018-12-24′。</li> <li>在查询条件中使用正则表达式时，只有在搜索模板的第一个字符不是通配符的情况下才能使用索引。</li> <li>在查询条件中使用&lt;&gt;会导致索引失效。</li> <li>在查询条件中使用 IS NULL 会导致索引失效。</li> <li>在查询条件中使用 OR 连接多个条件会导致索引失效，这时应该改为两次查询，然后用 UNION ALL 连接起来。</li> <li>尽量不要包括多列排序，如果一定要，最好为这队列构建组合索引；</li> <li>只有当数据库里已经有了足够多的测试数据时，它的性能测试结果才有实际参考价值。如果在测试数据库里只有几百条数据记录，它们往往在执行完第一条查询命令之后就被全部加载到内存里，这将使后续的查询命令都执行得非常快--不管有没有使用索引。只有当数据库里的记录超过了 1000 条、数据总量也超过了 MySQL 服务器上的内存总量时，数据库的性能测试结果才有意义。</li></ul> <h2 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h2> <ul><li>[参考 1]：高可用 MYSQL</li></ul></div> <!----> <!----> </div></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.82e01c61.js" defer></script><script src="/blog/assets/js/2.cf64eefe.js" defer></script><script src="/blog/assets/js/22.70640872.js" defer></script>
  </body>
</html>
